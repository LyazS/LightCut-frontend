# åŠ¨ç”»æ’å€¼ä¸è‡ªåŠ¨ä¿å­˜å†²çªè§£å†³æ–¹æ¡ˆï¼ˆæœ€ç»ˆç‰ˆï¼šå¯é€‰ + è¾…åŠ©å‡½æ•°ï¼‰

## é—®é¢˜æè¿°

åœ¨ LightCut è§†é¢‘ç¼–è¾‘å™¨ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå…³é”®çš„æ¶æ„å†²çªï¼š

### å†²çªåœºæ™¯
1. **æ’­æ”¾æ—¶çš„åŠ¨ç”»æ’å€¼**ï¼š[`applyAnimationToConfig()`](LightCut-frontend/src/core/utils/animationInterpolation.ts:106) åœ¨æ’­æ”¾æ—¶ä»¥ 30fps çš„é¢‘ç‡è®¡ç®—å…³é”®å¸§ä¹‹é—´çš„æ’å€¼ï¼Œå¹¶å°†ç»“æœå†™å…¥ `item.config`
2. **è‡ªåŠ¨ä¿å­˜ç›‘å¬**ï¼š[`UnifiedAutoSaveModule.ts`](LightCut-frontend/src/core/modules/UnifiedAutoSaveModule.ts:322-333) ä¸­çš„ `timelineItems` watcher æ·±åº¦ç›‘å¬æ‰€æœ‰ timeline items çš„å˜åŒ–
3. **ç»“æœ**ï¼šæ¯æ¬¡åŠ¨ç”»æ’å€¼ä¿®æ”¹ `config` éƒ½ä¼šè§¦å‘è‡ªåŠ¨ä¿å­˜ï¼Œå¯¼è‡´é¢‘ç¹çš„ä¿å­˜æ“ä½œ

### æ ¸å¿ƒçŸ›ç›¾
- **åŠ¨ç”»æ’å€¼**ï¼šéœ€è¦å®æ—¶ä¿®æ”¹æ˜¾ç¤ºå±æ€§ï¼ˆ30fpsï¼‰
- **è‡ªåŠ¨ä¿å­˜**ï¼šåªåº”è¯¥ä¿å­˜ç”¨æˆ·çš„ç¼–è¾‘æ“ä½œï¼Œä¸åº”è¯¥ä¿å­˜ä¸´æ—¶çš„åŠ¨ç”»æ’å€¼ç»“æœ

---

## æœ€ç»ˆæ–¹æ¡ˆï¼šrenderConfig å¯é€‰ + è¾…åŠ©å‡½æ•°

### æ ¸å¿ƒè®¾è®¡å†³ç­–

ç»è¿‡æ·±å…¥åˆ†æå’Œæƒè¡¡ï¼Œ`renderConfig` åº”è¯¥ä¿æŒä¸º**å¯é€‰å­—æ®µ**ï¼Œå¹¶é€šè¿‡**è¾…åŠ©å‡½æ•°**ä¼˜é›…åœ°è®¿é—®ã€‚

### ä¸ºä»€ä¹ˆå¯é€‰ï¼Ÿ

#### 1. ç±»å‹å®‰å…¨çš„çŸ›ç›¾

å¦‚æœ `renderConfig` æ˜¯å¿…é€‰å­—æ®µï¼š
```typescript
// âŒ ç±»å‹é”™è¯¯
clonedItem.runtime = {}  // runtime.renderConfig æ˜¯å¿…é€‰çš„ï¼Œä½†è¿™é‡Œæ˜¯ç©ºå¯¹è±¡
```

å¦‚æœ `renderConfig` æ˜¯å¯é€‰å­—æ®µï¼š
```typescript
// âœ… ç±»å‹æ­£ç¡®
clonedItem.runtime = {}  // å¯é€‰å­—æ®µå¯ä»¥ä¸å­˜åœ¨
```

#### 2. è¯­ä¹‰æ­£ç¡®æ€§

- `renderConfig` æ˜¯**è¿è¡Œæ—¶æ•°æ®**ï¼Œåªåœ¨è¿è¡Œæ—¶éœ€è¦
- åºåˆ—åŒ–æ—¶ä¸éœ€è¦ï¼Œæ‰€ä»¥å¯ä»¥ä¸å­˜åœ¨
- è¿™ç¬¦åˆ"å¯é€‰"çš„çœŸå®è¯­ä¹‰

#### 3. æ€§èƒ½ä¼˜åŒ–

- æ‡’åŠ è½½ï¼šåªåœ¨éœ€è¦æ—¶åˆ›å»º
- èŠ‚çœå†…å­˜

### ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼šè¾…åŠ©å‡½æ•°

**é—®é¢˜**ï¼šä¸æƒ³åˆ°å¤„å†™ `item.runtime.renderConfig || item.config`

**è§£å†³**ï¼šé€šè¿‡è¾…åŠ©å‡½æ•°ç»Ÿä¸€è®¿é—®

```typescript
// TimelineItemQueries.ts ä¸­æ·»åŠ 
export function getRenderConfig<T extends MediaType>(
  item: UnifiedTimelineItemData<T>
): GetConfigs<T> {
  return item.runtime.renderConfig || item.config
}

// ä½¿ç”¨æ—¶
const config = TimelineItemQueries.getRenderConfig(item)
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç»Ÿä¸€çš„è®¿é—®ç‚¹
- âœ… ç±»å‹å®‰å…¨
- âœ… æ˜“äºç»´æŠ¤
- âœ… å¯ä»¥æ·»åŠ æ—¥å¿—ã€è°ƒè¯•ç­‰é€»è¾‘
- âœ… ä¸éœ€è¦åˆ°å¤„å†™ `|| config`

---

## æ¶æ„è®¾è®¡

### æ•°æ®ç»“æ„

```typescript
export interface UnifiedTimelineItemRuntime<T extends MediaType = MediaType> {
  bunnyClip?: Raw<BunnyClip>
  textBitmap?: ImageBitmap
  renderConfig?: GetConfigs<T>  // âœ… å¯é€‰ï¼šåŠ¨ç”»æ’å€¼åçš„ä¸´æ—¶é…ç½®
}
```

### æ•°æ®æµ

```mermaid
graph TB
    A[ç”¨æˆ·ç¼–è¾‘] --> B[item.config]
    B --> C[æŒä¹…åŒ–ä¿å­˜]
    
    D[æ’­æ”¾/æ¸²æŸ“] --> E[applyAnimationToConfig]
    E --> F[item.runtime.renderConfig]
    F --> G[Canvasæ¸²æŸ“]
    
    H[è¯»å–é…ç½®] --> I[getRenderConfigè¾…åŠ©å‡½æ•°]
    I --> J{renderConfigå­˜åœ¨?}
    J -->|æ˜¯| F
    J -->|å¦| B
    
    style B fill:#90EE90
    style F fill:#FFB6C1
    style C fill:#87CEEB
    style I fill:#FFD700
```

### æ•°æ®æµç¨‹è¯¦è§£

#### 1. åˆå§‹åŒ–é˜¶æ®µ
```typescript
// åˆ›å»º TimelineItem æ—¶
item.config = { x: 100, y: 200, ... }
item.runtime = {}  // renderConfig ä¸å­˜åœ¨ï¼ˆæ‡’åŠ è½½ï¼‰
```

#### 2. é¦–æ¬¡æ¸²æŸ“/åŠ¨ç”»é˜¶æ®µ
```typescript
// applyAnimationToConfig ä¸­æ‡’åŠ è½½
if (!item.runtime.renderConfig) {
  item.runtime.renderConfig = { ...item.config }  // é¦–æ¬¡åˆ›å»º
}
Object.assign(item.runtime.renderConfig, item.config, animatedProps)
```

#### 3. æ¸²æŸ“é˜¶æ®µ
```typescript
// ä½¿ç”¨è¾…åŠ©å‡½æ•°
const config = TimelineItemQueries.getRenderConfig(item)
renderItem(config, ctx)
```

#### 4. ç”¨æˆ·ç¼–è¾‘é˜¶æ®µ
```typescript
// ç”¨æˆ·æ‹–åŠ¨å…ƒç´ 
item.config.x = 300  // ä¿®æ”¹åŸå§‹å€¼
// renderConfig åœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶è‡ªåŠ¨åŒæ­¥ï¼ˆé€šè¿‡ applyAnimationToConfigï¼‰

// è§¦å‘è‡ªåŠ¨ä¿å­˜ï¼ˆåªä¿å­˜ configï¼‰
autoSave({ contentChanged: true })
```

#### 5. åºåˆ—åŒ–é˜¶æ®µ
```typescript
// æ¸…ç©º runtime
clonedItem.runtime = {}  // âœ… renderConfig æ˜¯å¯é€‰çš„ï¼Œä¸ä¼šæŠ¥é”™
```

---

## è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### 1. æ·»åŠ è¾…åŠ©å‡½æ•°

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/timelineitem/queries.ts`](LightCut-frontend/src/core/timelineitem/queries.ts)

```typescript
/**
 * è·å–ç”¨äºæ¸²æŸ“çš„é…ç½®
 * ä¼˜å…ˆè¿”å› renderConfigï¼ˆåŒ…å«åŠ¨ç”»æ’å€¼ï¼‰ï¼Œå¦åˆ™è¿”å› config
 * 
 * @param item æ—¶é—´è½´é¡¹ç›®
 * @returns ç”¨äºæ¸²æŸ“çš„é…ç½®å¯¹è±¡
 */
export function getRenderConfig<T extends MediaType>(
  item: UnifiedTimelineItemData<T>
): GetConfigs<T> {
  return item.runtime.renderConfig || item.config
}

// å¯¼å‡ºåˆ° TimelineItemQueries
export const TimelineItemQueries = {
  // ç±»å‹å®ˆå«
  isVideoTimelineItem,
  isImageTimelineItem,
  isAudioTimelineItem,
  isTextTimelineItem,
  hasVisualProperties,
  hasAudioProperties,

  // çŠ¶æ€æŸ¥è¯¢
  isReady,
  isLoading,
  hasError,
  canEdit,
  getStatusText,
  getProgressInfo,
  getErrorInfo,
  
  // é…ç½®è®¿é—®ï¼ˆæ–°å¢ï¼‰
  getRenderConfig,
}
```

### 2. ä¿®æ”¹åŠ¨ç”»æ’å€¼é€»è¾‘

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/utils/animationInterpolation.ts`](LightCut-frontend/src/core/utils/animationInterpolation.ts:106)

**æ”¹åŠ¨ä½ç½®**ï¼šç¬¬ 152 è¡Œ

```typescript
export function applyAnimationToConfig(
  item: UnifiedTimelineItemData<MediaType>,
  currentAbsoluteFrame: number
): void {
  // 1. æ‡’åŠ è½½ï¼šé¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ– renderConfig
  if (!item.runtime.renderConfig) {
    item.runtime.renderConfig = { ...item.config }
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦æœ‰åŠ¨ç”»
  if (!item.animation || item.animation.keyframes.length === 0) {
    // æ²¡æœ‰åŠ¨ç”»æ—¶ï¼Œç¡®ä¿ renderConfig ä¸ config åŒæ­¥
    Object.assign(item.runtime.renderConfig, item.config)
    return
  }
  
  // 3. æ£€æŸ¥æ˜¯å¦åœ¨æ—¶é—´èŒƒå›´å†…
  const isInTimeRange =
    currentAbsoluteFrame >= item.timeRange.timelineStartTime &&
    currentAbsoluteFrame <= item.timeRange.timelineEndTime
  if (!isInTimeRange) {
    // ä¸åœ¨èŒƒå›´å†…ï¼Œä½¿ç”¨åŸå§‹ config
    Object.assign(item.runtime.renderConfig, item.config)
    return
  }
  
  // 4-6. è®¡ç®—åŠ¨ç”»å±æ€§ï¼ˆä¿æŒä¸å˜ï¼‰
  // ...
  
  // 7. âœ… åº”ç”¨åˆ° runtime.renderConfigï¼ˆä¸è§¦å‘è‡ªåŠ¨ä¿å­˜ï¼‰
  Object.assign(item.runtime.renderConfig, item.config, animatedProps)
}
```

**å…³é”®æ”¹è¿›**ï¼š
- æ‡’åŠ è½½ï¼šåªåœ¨é¦–æ¬¡éœ€è¦æ—¶åˆ›å»º `renderConfig`
- ä¸ä¿®æ”¹ `config`ï¼Œé¿å…è§¦å‘è‡ªåŠ¨ä¿å­˜

### 3. ä¿®æ”¹æ¸²æŸ“é€»è¾‘

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/bunnyUtils/canvasRenderer.ts`](LightCut-frontend/src/core/bunnyUtils/canvasRenderer.ts:88)

**æ”¹åŠ¨ä½ç½®**ï¼šç¬¬ 88 è¡Œ

```typescript
import { TimelineItemQueries } from '@/core/timelineitem/queries'

export function renderItem(
  item: UnifiedTimelineItemData<MediaType>,
  ctx: CanvasRenderingContext2D,
  bunnyCurFrameMap: Map<string, FrameData>,
  getMediaItem: (mediaItemId: string) => UnifiedMediaItemData | undefined,
): void {
  // æ£€æŸ¥æ˜¯å¦æœ‰è§†è§‰å±æ€§
  if (!TimelineItemQueries.hasVisualProperties(item)) {
    return
  }

  // âœ… ä½¿ç”¨è¾…åŠ©å‡½æ•°è·å–æ¸²æŸ“é…ç½®
  const visualConfig = TimelineItemQueries.getRenderConfig(item)

  // æ¸²æŸ“é€»è¾‘ä¿æŒä¸å˜...
}
```

### 4. ä¿®æ”¹å±æ€§é¢æ¿æ˜¾ç¤º

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/composables/useKeyframeTransformControls.ts`](LightCut-frontend/src/core/composables/useKeyframeTransformControls.ts)

**éœ€è¦ä¿®æ”¹çš„è®¡ç®—å±æ€§**ï¼š
- `transformX`ã€`transformY`
- `scaleX`ã€`scaleY`
- `rotation`ã€`opacity`
- `volume`

**æ”¹åŠ¨ç¤ºä¾‹**ï¼ˆä»¥ `transformX` ä¸ºä¾‹ï¼‰ï¼š

```typescript
import { TimelineItemQueries } from '@/core/timelineitem/queries'

const transformX = computed(() => {
  if (!selectedTimelineItem.value) return 0
  if (!TimelineItemQueries.hasVisualProperties(selectedTimelineItem.value)) return 0
  
  // âœ… ä½¿ç”¨è¾…åŠ©å‡½æ•°
  const config = TimelineItemQueries.getRenderConfig(selectedTimelineItem.value)
  return config.x
})
```

### 5. ä¿®æ”¹å…³é”®å¸§åˆ›å»ºé€»è¾‘

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/utils/unifiedKeyframeUtils.ts`](LightCut-frontend/src/core/utils/unifiedKeyframeUtils.ts:82)

**æ”¹åŠ¨ä½ç½®**ï¼š`createKeyframe()` å‡½æ•°ä¸­è¯»å–å½“å‰å€¼çš„åœ°æ–¹

**éœ€è¦ä¿®æ”¹çš„åœºæ™¯**ï¼š
1. Video ç±»å‹ï¼ˆç¬¬ 93-110 è¡Œï¼‰
2. Image/Text ç±»å‹ï¼ˆç¬¬ 111-126 è¡Œï¼‰
3. Audio ç±»å‹ï¼ˆç¬¬ 127-137 è¡Œï¼‰

**æ”¹åŠ¨ç¤ºä¾‹**ï¼ˆä»¥ Video ç±»å‹ä¸ºä¾‹ï¼‰ï¼š

```typescript
import { TimelineItemQueries } from '@/core/timelineitem/queries'

export function createKeyframe(
  item: UnifiedTimelineItemData<MediaType>,
  currentAbsoluteFrame: number,
  propertyName?: string
): AnimateKeyframe<MediaType> | null {
  // ... å‰é¢çš„ä»£ç ä¸å˜

  if (TimelineItemQueries.isVideoTimelineItem(item)) {
    // âœ… ä½¿ç”¨è¾…åŠ©å‡½æ•°è·å–å½“å‰æ˜¾ç¤ºçš„å€¼
    const config = TimelineItemQueries.getRenderConfig(item)
    
    return {
      id: generateId(),
      position: percentage,
      properties: {
        x: config.x,
        y: config.y,
        scaleX: config.scaleX,
        scaleY: config.scaleY,
        rotation: config.rotation,
        opacity: config.opacity,
        volume: config.volume,
      },
    }
  }
  
  // ... å…¶ä»–ç±»å‹ç±»ä¼¼ä¿®æ”¹
}
```

### 6. ä¿®æ”¹æ’­æ”¾æ¨¡å—éŸ³é‡è¯»å–

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/modules/UnifiedMediaBunnyModule.ts`](LightCut-frontend/src/core/modules/UnifiedMediaBunnyModule.ts)

**æ”¹åŠ¨ä½ç½®**ï¼šç¬¬ 328-329 è¡Œï¼ˆ`updateClips` æ–¹æ³•ä¸­ï¼‰

```typescript
import { TimelineItemQueries } from '@/core/timelineitem/queries'

// åœ¨ updateClips æ–¹æ³•ä¸­ï¼Œè¯»å–éŸ³é‡å’Œé™éŸ³çŠ¶æ€æ—¶
private updateClips(currentAbsoluteFrame: number): void {
  // ... å‰é¢çš„ä»£ç 

  for (const item of this.timelineModule.timelineItems.value) {
    // ... å…¶ä»–é€»è¾‘

    // âœ… ä½¿ç”¨è¾…åŠ©å‡½æ•°è·å–æ¸²æŸ“é…ç½®ï¼ˆåŒ…å«åŠ¨ç”»æ’å€¼åçš„éŸ³é‡ï¼‰
    const config = TimelineItemQueries.getRenderConfig(item)
    const isItemMuted = config.isMuted ?? false
    const itemVolume = config.volume ?? 1.0

    // åº”ç”¨éŸ³é‡åˆ° BunnyClip
    if (item.runtime.bunnyClip) {
      item.runtime.bunnyClip.setVolume(isItemMuted ? 0 : itemVolume)
    }

    // ... åç»­é€»è¾‘
  }
}
```

**è¯´æ˜**ï¼š
- è¿™æ˜¯æ’­æ”¾æ—¶å®æ—¶è¯»å–éŸ³é‡çš„å…³é”®ä½ç½®
- å¿…é¡»ä½¿ç”¨ `getRenderConfig()` æ‰èƒ½è·å–åŠ¨ç”»æ’å€¼åçš„éŸ³é‡å€¼
- å¦åˆ™éŸ³é‡åŠ¨ç”»åœ¨æ’­æ”¾æ—¶ä¸ä¼šç”Ÿæ•ˆ

### 7. ä¿®æ”¹å¯¼å‡ºé€»è¾‘

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/utils/projectExporter.ts`](LightCut-frontend/src/core/utils/projectExporter.ts:261)

**æ”¹åŠ¨ä½ç½®**ï¼šç¬¬ 261 è¡Œ

```typescript
import { TimelineItemQueries } from '@/core/timelineitem/queries'

// åœ¨ renderFrameAndCollectAudio æ–¹æ³•ä¸­
// æ”¶é›†éŸ³é¢‘ç¼“å†²ï¼ˆä½¿ç”¨ item.id ä½œä¸ºé”®ï¼‰
if (shouldRequestAudio && audio && audio.length > 0) {
  // âœ… ä½¿ç”¨è¾…åŠ©å‡½æ•°è·å–å½“å‰éŸ³é‡å€¼ï¼ˆåº”ç”¨äº†åŠ¨ç”»æ’å€¼ï¼‰
  const config = TimelineItemQueries.getRenderConfig(item)
  const currentVolume = config.volume ?? 1.0
  
  audioBuffersMap.set(item.id, {
    buffers: audio,
    volume: currentVolume,
  })
}
```

### 8. è‡ªåŠ¨ä¿å­˜ç›‘å¬ï¼ˆç²¾ç¡®å­—æ®µï¼‰

**æ–‡ä»¶**ï¼š[`LightCut-frontend/src/core/modules/UnifiedAutoSaveModule.ts`](LightCut-frontend/src/core/modules/UnifiedAutoSaveModule.ts:322-333)

**æ”¹åŠ¨ä½ç½®**ï¼šæ¢å¤è¢«æ³¨é‡Šçš„ `timelineItems` watcher

```typescript
// ç›‘å¬æ—¶é—´è½´é¡¹ç›®å˜åŒ– - å†…å®¹å˜åŒ–
// âœ… ä½¿ç”¨ç²¾ç¡®å­—æ®µç›‘å¬ï¼Œåªç›‘å¬éœ€è¦æŒä¹…åŒ–çš„å­—æ®µ
const unwatchTimelineItems = watch(
  () => dataWatchers.timelineItems.value?.map(item => ({
    id: item.id,
    mediaItemId: item.mediaItemId,
    trackId: item.trackId,
    timelineStatus: item.timelineStatus,
    mediaType: item.mediaType,
    timeRange: item.timeRange,
    config: item.config,        // âœ… ç›‘å¬
    animation: item.animation,  // âœ… ç›‘å¬
    // âŒ ä¸ç›‘å¬ runtimeï¼ˆåŒ…æ‹¬ runtime.renderConfigï¼‰
  })),
  () => {
    console.log('ğŸ” [AutoSave] timelineItems changed')
    triggerSave()
  },
  { deep: true }
)
```

**è¯´æ˜**ï¼š
- ä½¿ç”¨ `map()` åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåªåŒ…å«éœ€è¦æŒä¹…åŒ–çš„å­—æ®µ
- æ˜ç¡®æ’é™¤ `runtime` å­—æ®µï¼ˆåŒ…æ‹¬ `runtime.renderConfig`ï¼‰
- è¿™æ ·åŠ¨ç”»æ’å€¼ä¿®æ”¹ `runtime.renderConfig` æ—¶ä¸ä¼šè§¦å‘è‡ªåŠ¨ä¿å­˜
- ä½†ç”¨æˆ·ç¼–è¾‘ `config` æˆ– `animation` æ—¶ä¼šæ­£å¸¸è§¦å‘è‡ªåŠ¨ä¿å­˜

### 9. åºåˆ—åŒ–é€»è¾‘ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

**æ–‡ä»¶**ï¼š[`UnifiedProjectModule.ts`](LightCut-frontend/src/core/modules/UnifiedProjectModule.ts:184-190)

**å½“å‰ä»£ç **ï¼ˆå·²ç»å®Œç¾ï¼‰ï¼š
```typescript
updatedProjectTimeline = {
  tracks: trackModule.tracks.value,
  timelineItems: timelineModule.timelineItems.value.map((item) => {
    const clonedItem = TimelineItemFactory.clone(item)
    if (clonedItem.runtime) {
      clonedItem.runtime = {}  // âœ… æ¸…ç©º runtimeï¼ŒrenderConfig æ˜¯å¯é€‰çš„ï¼Œä¸ä¼šæŠ¥é”™
    }
    return clonedItem
  }),
}
```

**è¯´æ˜**ï¼š
- âœ… é€šè¿‡ `clonedItem.runtime = {}` æ¸…ç©ºæ•´ä¸ª `runtime` å¯¹è±¡
- âœ… `runtime.renderConfig` ä¸ä¼šè¢«ä¿å­˜
- âœ… åªæœ‰ `config` ä¼šè¢«ä¿å­˜
- âœ… ä¸éœ€è¦åˆ›å»ºæ–°çš„åºåˆ—åŒ–ç±»å‹

---

## æ ¸å¿ƒä¼˜åŠ¿

### 1. ç±»å‹å®‰å…¨
- âœ… åºåˆ—åŒ–æ—¶ `runtime = {}` ä¸ä¼šæŠ¥é”™
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡

### 2. ä»£ç ä¼˜é›…
- âœ… é€šè¿‡ `getRenderConfig()` ç»Ÿä¸€è®¿é—®
- âœ… ä¸éœ€è¦åˆ°å¤„å†™ `|| config`
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 3. æ€§èƒ½ä¼˜åŒ–
- âœ… æ‡’åŠ è½½ï¼šåªåœ¨éœ€è¦æ—¶åˆ›å»º
- âœ… èŠ‚çœå†…å­˜
- âœ… ç²¾ç¡®å­—æ®µç›‘å¬

### 4. é˜²å¾¡æ€§ç¼–ç¨‹
- âœ… è‡ªåŠ¨å›é€€åˆ° `config`
- âœ… å®¹é”™æ€§å¼º

### 5. å¯æ‰©å±•æ€§
- âœ… å¯ä»¥åœ¨è¾…åŠ©å‡½æ•°ä¸­æ·»åŠ æ—¥å¿—
- âœ… å¯ä»¥æ·»åŠ å¼€å‘æ¨¡å¼çš„æ£€æŸ¥
- âœ… ç»Ÿä¸€çš„è®¿é—®ç‚¹ä¾¿äºæœªæ¥ä¼˜åŒ–

---

## å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šæ·»åŠ è¾…åŠ©å‡½æ•°
- [ ] åœ¨ `TimelineItemQueries.ts` ä¸­æ·»åŠ  `getRenderConfig()` å‡½æ•°
- [ ] å¯¼å‡ºåˆ° `TimelineItemQueries` å¯¹è±¡

### æ­¥éª¤2ï¼šä¿®æ”¹åŠ¨ç”»æ’å€¼é€»è¾‘
- [ ] ä¿®æ”¹ `applyAnimationToConfig()`ï¼Œæ·»åŠ æ‡’åŠ è½½é€»è¾‘
- [ ] æ”¹ä¸ºä¿®æ”¹ `runtime.renderConfig` è€Œä¸æ˜¯ `config`

### æ­¥éª¤3ï¼šä¿®æ”¹æ¸²æŸ“é€»è¾‘
- [ ] ä¿®æ”¹ `renderItem()`ï¼Œä½¿ç”¨ `getRenderConfig()` è¾…åŠ©å‡½æ•°
- [ ] æ£€æŸ¥ `isInBounds` ç­‰å…¶ä»–æ¸²æŸ“ç›¸å…³ä»£ç 

### æ­¥éª¤4ï¼šä¿®æ”¹å±æ€§é¢æ¿æ˜¾ç¤º
- [ ] ä¿®æ”¹ `useKeyframeTransformControls.ts` ä¸­çš„æ‰€æœ‰è®¡ç®—å±æ€§
- [ ] ä½¿ç”¨ `getRenderConfig()` è¾…åŠ©å‡½æ•°
- [ ] éœ€è¦ä¿®æ”¹çš„å±æ€§ï¼š`transformX`ã€`transformY`ã€`scaleX`ã€`scaleY`ã€`rotation`ã€`opacity`ã€`volume`

### æ­¥éª¤5ï¼šä¿®æ”¹å…³é”®å¸§åˆ›å»ºé€»è¾‘
- [ ] ä¿®æ”¹ `createKeyframe()` å‡½æ•°
- [ ] ä½¿ç”¨ `getRenderConfig()` è¾…åŠ©å‡½æ•°è·å–å½“å‰å€¼
- [ ] ç¡®ä¿åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­åˆ›å»ºå…³é”®å¸§æ—¶ï¼Œä½¿ç”¨åŠ¨ç”»æ’å€¼åçš„å®æ—¶å€¼

### æ­¥éª¤6ï¼šä¿®æ”¹æ’­æ”¾æ¨¡å—éŸ³é‡è¯»å–
- [ ] ä¿®æ”¹ `UnifiedMediaBunnyModule.ts` ç¬¬328-329è¡Œ
- [ ] ä½¿ç”¨ `getRenderConfig()` è¾…åŠ©å‡½æ•°è¯»å–éŸ³é‡å’Œé™éŸ³çŠ¶æ€
- [ ] ç¡®ä¿æ’­æ”¾æ—¶éŸ³é‡åŠ¨ç”»æ­£ç¡®åº”ç”¨

### æ­¥éª¤7ï¼šä¿®æ”¹å¯¼å‡ºé€»è¾‘
- [ ] ä¿®æ”¹ `projectExporter.ts` ç¬¬261è¡Œ
- [ ] ä½¿ç”¨ `getRenderConfig()` è¾…åŠ©å‡½æ•°è¯»å–éŸ³é‡å€¼

### æ­¥éª¤8ï¼šæ¢å¤è‡ªåŠ¨ä¿å­˜ç›‘å¬
- [ ] æ¢å¤ `timelineItems` ç›‘å¬å™¨
- [ ] ä½¿ç”¨ç²¾ç¡®å­—æ®µç›‘å¬ï¼Œæ’é™¤ `runtime` å­—æ®µ

### æ­¥éª¤9ï¼šæµ‹è¯•éªŒè¯
- [ ] æµ‹è¯•æ— åŠ¨ç”»åœºæ™¯
- [ ] æµ‹è¯•æœ‰åŠ¨ç”»åœºæ™¯
- [ ] æµ‹è¯•è‡ªåŠ¨ä¿å­˜è§¦å‘
- [ ] æµ‹è¯•å…³é”®å¸§åˆ›å»º
- [ ] æµ‹è¯•åºåˆ—åŒ–å’Œååºåˆ—åŒ–

---

## æ ¸å¿ƒæ”¹åŠ¨ç‚¹æ€»ç»“

### 10ä¸ªæ ¸å¿ƒä¿®æ”¹ç‚¹

1. **è¾…åŠ©å‡½æ•°**ï¼š[`TimelineItemQueries.getRenderConfig()`](LightCut-frontend/src/core/timelineitem/queries.ts) - ç»Ÿä¸€çš„é…ç½®è®¿é—®ç‚¹
2. **åŠ¨ç”»æ’å€¼**ï¼š[`applyAnimationToConfig()`](LightCut-frontend/src/core/utils/animationInterpolation.ts:106) - æ‡’åŠ è½½ + ä¿®æ”¹ `runtime.renderConfig`
3. **æ¸²æŸ“é€»è¾‘**ï¼š[`renderItem()`](LightCut-frontend/src/core/bunnyUtils/canvasRenderer.ts:88) - ä½¿ç”¨ `getRenderConfig()`
4. **å±æ€§æ˜¾ç¤º**ï¼š[`useKeyframeTransformControls.ts`](LightCut-frontend/src/core/composables/useKeyframeTransformControls.ts) - ä½¿ç”¨ `getRenderConfig()`
5. **å…³é”®å¸§åˆ›å»º**ï¼š[`createKeyframe()`](LightCut-frontend/src/core/utils/unifiedKeyframeUtils.ts:82) - ä½¿ç”¨ `getRenderConfig()`
6. **æ’­æ”¾éŸ³é‡**ï¼š[`UnifiedMediaBunnyModule.ts`](LightCut-frontend/src/core/modules/UnifiedMediaBunnyModule.ts:328-329) - ä½¿ç”¨ `getRenderConfig()` è¯»å–éŸ³é‡å’Œé™éŸ³çŠ¶æ€
7. **å¯¼å‡ºéŸ³é‡**ï¼š[`projectExporter.ts`](LightCut-frontend/src/core/utils/projectExporter.ts:261) - ä½¿ç”¨ `getRenderConfig()`
8. **è‡ªåŠ¨ä¿å­˜ç›‘å¬**ï¼š[`UnifiedAutoSaveModule.ts`](LightCut-frontend/src/core/modules/UnifiedAutoSaveModule.ts) - ç²¾ç¡®å­—æ®µç›‘å¬ï¼Œæ’é™¤ `runtime`
9. **åºåˆ—åŒ–**ï¼š[`UnifiedProjectModule.ts`](LightCut-frontend/src/core/modules/UnifiedProjectModule.ts:184-190) - æ— éœ€ä¿®æ”¹ï¼ˆå·²å®Œç¾ï¼‰
10. **ç±»å‹å®šä¹‰**ï¼š[`UnifiedTimelineItemRuntime`](LightCut-frontend/src/core/timelineitem/type.ts:68) - ä¿æŒ `renderConfig?` å¯é€‰

### ä¿æŒä¸å˜

- âœ… ç”¨æˆ·ç¼–è¾‘é€»è¾‘ï¼ˆ[`handlePropertyChange()`](LightCut-frontend/src/core/utils/unifiedKeyframeUtils.ts:539) æ™ºèƒ½å¤„ç†ï¼‰
- âœ… å…³é”®å¸§ç³»ç»Ÿï¼ˆåˆ›å»º/æ›´æ–°/åˆ é™¤å…³é”®å¸§ï¼‰
- âœ… å‘½ä»¤ç³»ç»Ÿï¼ˆå†å²è®°å½•å’Œæ’¤é”€é‡åšï¼‰

---

## ä»£ç ç¤ºä¾‹å¯¹æ¯”

### æ”¹åŠ¨å‰ï¼ˆä¸ä¼˜é›…ï¼‰
```typescript
// åˆ°å¤„éƒ½è¦å†™å›é€€é€»è¾‘
const config1 = item.runtime.renderConfig || item.config
const config2 = item.runtime.renderConfig || item.config
const config3 = item.runtime.renderConfig || item.config
```

### æ”¹åŠ¨åï¼ˆä¼˜é›…ï¼‰
```typescript
// ç»Ÿä¸€ä½¿ç”¨è¾…åŠ©å‡½æ•°
const config1 = TimelineItemQueries.getRenderConfig(item)
const config2 = TimelineItemQueries.getRenderConfig(item)
const config3 = TimelineItemQueries.getRenderConfig(item)
```

---

## æµ‹è¯•è®¡åˆ’

### 1. è¾…åŠ©å‡½æ•°æµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯ `getRenderConfig()` æ­£ç¡®å·¥ä½œ

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘åˆ°æ—¶é—´è½´
3. æ£€æŸ¥ `getRenderConfig()` è¿”å›å€¼
4. æ·»åŠ åŠ¨ç”»å¹¶æ’­æ”¾
5. å†æ¬¡æ£€æŸ¥ `getRenderConfig()` è¿”å›å€¼

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ— åŠ¨ç”»æ—¶è¿”å› `config`
- âœ… æœ‰åŠ¨ç”»æ—¶è¿”å› `renderConfig`ï¼ˆåŒ…å«æ’å€¼ï¼‰

### 2. æ— åŠ¨ç”»åœºæ™¯æµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯æ²¡æœ‰åŠ¨ç”»æ—¶çš„æ­£å¸¸å·¥ä½œ

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘/å›¾ç‰‡/æ–‡æœ¬åˆ°æ—¶é—´è½´
3. ä¸æ·»åŠ ä»»ä½•å…³é”®å¸§
4. æ’­æ”¾å¹¶è§‚å¯Ÿæ¸²æŸ“æ•ˆæœ
5. ä¿®æ”¹å±æ€§ï¼ˆä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼‰
6. éªŒè¯è‡ªåŠ¨ä¿å­˜æ˜¯å¦æ­£å¸¸è§¦å‘

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ¸²æŸ“æ­£å¸¸ï¼ˆä½¿ç”¨ `config`ï¼‰
- âœ… å±æ€§é¢æ¿æ˜¾ç¤ºæ­£ç¡®ï¼ˆä½¿ç”¨ `config`ï¼‰
- âœ… ä¿®æ”¹å±æ€§åè‡ªåŠ¨ä¿å­˜æ­£å¸¸è§¦å‘
- âœ… ä¿å­˜çš„æ•°æ®ä¸­ `runtime` ä¸ºç©ºå¯¹è±¡

### 3. æœ‰åŠ¨ç”»åœºæ™¯æµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯åŠ¨ç”»æ’å€¼å’Œè‡ªåŠ¨ä¿å­˜çš„éš”ç¦»

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘åˆ°æ—¶é—´è½´
3. åœ¨ä¸åŒä½ç½®åˆ›å»ºå¤šä¸ªå…³é”®å¸§ï¼ˆä¾‹å¦‚ä½ç½®åŠ¨ç”»ï¼‰
4. æ’­æ”¾å¹¶è§‚å¯Ÿï¼š
   - åŠ¨ç”»æ˜¯å¦æµç•…
   - å±æ€§é¢æ¿æ˜¯å¦æ˜¾ç¤ºå®æ—¶æ’å€¼åçš„å€¼
   - æ§åˆ¶å°æ˜¯å¦é¢‘ç¹è¾“å‡ºè‡ªåŠ¨ä¿å­˜æ—¥å¿—
5. åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­æš‚åœï¼Œä¿®æ”¹å±æ€§
6. éªŒè¯è‡ªåŠ¨ä¿å­˜æ˜¯å¦æ­£å¸¸è§¦å‘

**é¢„æœŸç»“æœ**ï¼š
- âœ… åŠ¨ç”»æ’­æ”¾æµç•…
- âœ… å±æ€§é¢æ¿æ˜¾ç¤ºå®æ—¶æ’å€¼å€¼ï¼ˆä½¿ç”¨ `renderConfig`ï¼‰
- âœ… æ’­æ”¾æ—¶ä¸è§¦å‘è‡ªåŠ¨ä¿å­˜ï¼ˆ`renderConfig` å˜åŒ–ä¸è¢«ç›‘å¬ï¼‰
- âœ… ä¿®æ”¹å±æ€§åè‡ªåŠ¨ä¿å­˜æ­£å¸¸è§¦å‘ï¼ˆ`config` å˜åŒ–è¢«ç›‘å¬ï¼‰
- âœ… ä¿å­˜çš„æ•°æ®ä¸­åªæœ‰ `config` å’Œ `animation`ï¼Œæ²¡æœ‰ `renderConfig`

### 4. å…³é”®å¸§åˆ›å»ºæµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­åˆ›å»ºå…³é”®å¸§çš„æ­£ç¡®æ€§

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘åˆ°æ—¶é—´è½´
3. åˆ›å»ºä¸¤ä¸ªå…³é”®å¸§ï¼ˆä¾‹å¦‚ x=0 å’Œ x=100ï¼‰
4. æ’­æ”¾åˆ°ä¸­é—´ä½ç½®ï¼ˆä¾‹å¦‚ x=50ï¼‰
5. ç‚¹å‡»åˆ›å»ºå…³é”®å¸§æŒ‰é’®
6. æ£€æŸ¥æ–°åˆ›å»ºçš„å…³é”®å¸§çš„å€¼

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–°åˆ›å»ºçš„å…³é”®å¸§ä½¿ç”¨å½“å‰æ’å€¼åçš„å€¼ï¼ˆx=50ï¼‰
- âœ… è€Œä¸æ˜¯åŸå§‹ `config` çš„å€¼
- âœ… è¿™æ ·ç”¨æˆ·çœ‹åˆ°çš„å€¼å’Œä¿å­˜çš„å…³é”®å¸§å€¼ä¸€è‡´

### 5. æ’­æ”¾éŸ³é‡åŠ¨ç”»æµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯æ’­æ”¾æ—¶éŸ³é‡åŠ¨ç”»æ­£ç¡®åº”ç”¨

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘åˆ°æ—¶é—´è½´
3. åˆ›å»ºéŸ³é‡åŠ¨ç”»ï¼ˆä¾‹å¦‚ä» 1.0 åˆ° 0.0ï¼‰
4. æ’­æ”¾é¡¹ç›®
5. è§‚å¯ŸéŸ³é‡å˜åŒ–æ˜¯å¦å¹³æ»‘

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ’­æ”¾æ—¶éŸ³é‡ä» 1.0 å¹³æ»‘è¿‡æ¸¡åˆ° 0.0
- âœ… éŸ³é‡åŠ¨ç”»å®æ—¶ç”Ÿæ•ˆ
- âœ… é™éŸ³çŠ¶æ€æ­£ç¡®åº”ç”¨

### 6. å¯¼å‡ºæµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯å¯¼å‡ºæ—¶æ­£ç¡®åº”ç”¨éŸ³é‡åŠ¨ç”»

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘åˆ°æ—¶é—´è½´
3. åˆ›å»ºéŸ³é‡åŠ¨ç”»ï¼ˆä¾‹å¦‚ä» 1.0 åˆ° 0.0ï¼‰
4. å¯¼å‡ºé¡¹ç›®
5. æ’­æ”¾å¯¼å‡ºçš„è§†é¢‘ï¼Œæ£€æŸ¥éŸ³é‡å˜åŒ–

**é¢„æœŸç»“æœ**ï¼š
- âœ… å¯¼å‡ºçš„è§†é¢‘æ­£ç¡®åº”ç”¨äº†éŸ³é‡åŠ¨ç”»
- âœ… éŸ³é‡ä» 1.0 å¹³æ»‘è¿‡æ¸¡åˆ° 0.0

### 7. åºåˆ—åŒ–æµ‹è¯•
**ç›®æ ‡**ï¼šéªŒè¯ä¿å­˜å’ŒåŠ è½½çš„æ­£ç¡®æ€§

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è§†é¢‘é¡¹ç›®
2. æ·»åŠ è§†é¢‘å¹¶åˆ›å»ºåŠ¨ç”»
3. æ’­æ”¾ä¸€æ®µæ—¶é—´ï¼ˆè®© `renderConfig` è¢«åˆ›å»ºï¼‰
4. ä¿å­˜é¡¹ç›®
5. æ£€æŸ¥ä¿å­˜çš„ JSON æ–‡ä»¶
6. é‡æ–°åŠ è½½é¡¹ç›®
7. éªŒè¯é¡¹ç›®çŠ¶æ€

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä¿å­˜çš„ JSON ä¸­ `runtime` ä¸ºç©ºå¯¹è±¡ `{}`
- âœ… æ²¡æœ‰ `renderConfig` å­—æ®µ
- âœ… é‡æ–°åŠ è½½åé¡¹ç›®æ­£å¸¸å·¥ä½œ
- âœ… æ’­æ”¾æ—¶ `renderConfig` ä¼šè¢«æ‡’åŠ è½½åˆ›å»º

---

## æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾è§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼š

1. âœ… **ç±»å‹å®‰å…¨**ï¼šåºåˆ—åŒ–æ—¶ `runtime = {}` ä¸ä¼šæŠ¥é”™
2. âœ… **ä»£ç ä¼˜é›…**ï¼šé€šè¿‡ `getRenderConfig()` ç»Ÿä¸€è®¿é—®ï¼Œä¸éœ€è¦åˆ°å¤„å†™ `|| config`
3. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‡’åŠ è½½ + ç²¾ç¡®å­—æ®µç›‘å¬
4. âœ… **æ˜“äºç»´æŠ¤**ï¼šç»Ÿä¸€çš„è®¿é—®ç‚¹
5. âœ… **å‘åå…¼å®¹**ï¼šä¿å­˜æ ¼å¼ä¸å˜
6. âœ… **å½»åº•éš”ç¦»**ï¼šåŠ¨ç”»æ’å€¼å’ŒæŒä¹…åŒ–æ•°æ®å®Œå…¨åˆ†ç¦»
7. âœ… **è§£å†³å†²çª**ï¼šè‡ªåŠ¨ä¿å­˜ä¸å†è¢«åŠ¨ç”»è§¦å‘

**æœ€å…³é”®çš„æ˜¯**ï¼šé€šè¿‡è¾…åŠ©å‡½æ•° `TimelineItemQueries.getRenderConfig(item)` ä¼˜é›…åœ°è§£å†³äº†"åˆ°å¤„å†™ `|| config`"çš„é—®é¢˜ï¼